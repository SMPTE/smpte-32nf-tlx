{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "http://smpte-ra.com/2120/2/2021/smpte-tlx-items.json",
  "title": "TLX",
  "type": "object",
  "description": "Schema for the SMPTE Extensible Time Label (TLX).",

  "examples": [
    {
      "TLXptpTimestamp": { "ptpTime": [ 1234567890, 123456789 ],
        "currentLocalOffset": -25163 },
      "TLXmediaCount": { "count": 0, "rate": [ 30000, 1001 ] },
      "TLXuniqueSourceID": { "sourceID": "3ac760e0-e11b-11eb-ba80-0242ac130004" }
    },

    {
      "TLXst12": { "timeAddress": [ 1, 0, 9, 29 ], "fieldMark": false,
          "dropFrame": true, "modulus": "30",
          "binaryGroups": "47210719", "bgFlags": "6",
          "DBB1": "01", "DBB2": "00"
        },
      "TLXsourceName": { "name": "tape 001" }
    },

    { "TLXuniqueSourceID": { "sourceID": "8eb03111-2085-48b5-919a-cebbf292ab48" },
      "TLXmediaCount": { "count": 12000, "rate": [ 1000, 1 ] },
      "TLXmediaUnitRuntime": { "runtime": [ 3, 1 ] }
    },

    {
      "TLXmediaCount": { "count": 300, "rate": [24, 1] },
      "TLXmediaUnitRuntime": { "runtime": [110, 2400] }
    }
  ],

  "properties": {

    "TLXptpTimestamp": {
      "$id": "#TLXptpTimestamp",
      "title": "TLXptpTimestamp",
      "type": "object",
      "description": "Creation time of this TLX label.",
      "examples": [
        { "ptpTime": [ 1234567890, 999999999 ], "currentLocalOffset": -25163,
          "leapSecondEvent": false },
        { "ptpTime": [ 12345678901, 999999999 ], "currentLocalOffset": -25163},
        { "ptpTime": [ 12345678901, 999999999 ], "currentLocalOffset": -25163,
          "extensible": null }
      ],
      "properties": {
        "ptpTime": {
          "type": "array",
          "items": [
            { "description": "seconds",
               "type": "integer", 
               "minimum": 0, "exclusiveMaximum": 281474976710656 },
            { "description": "nanoseconds",
               "type": "integer",
               "minimum": 0, "exclusiveMaximum": 1000000000 }
          ],
          "minItems": 2,
          "additionalItems": false
        },
        "currentLocalOffset": {
          "type": "integer", "minimum": -2147483648, "exclusiveMaximum": 2147483648,
          "$comment": "ST 2059-2 limits to int32."
        },
        "leapSecondEvent": {
          "type": "boolean",
          "default": false
        }
      },
      "required": [ "ptpTime" ],
      "additionalProperties": true
    },

    "TLXmediaCount": {
      "$id": "#TLXmediaCount",
      "title": " TLXmediaCount ",
      "type": "object",
      "description": "Index of media unit in a sequence.",
      "examples": [
        { "count": 86400, "rate": [ 24, 1 ] },
        { "count": 107892, "rate": [ 30000, 1001 ] },
        { "count": 108000, "rate": [ 30, 1 ] },
        { "count": 108000 },
        { "count": 86400, "rate": [ 24, 1 ], "extensible": null }
      ],
      "properties": {
        "count": {
          "allOf": [
            { "$ref": "#/definitions/integerType" },
            { "minimum": 0 }
          ]
        },
        "rate": {
          "allOf": [
            { "$ref": "#/definitions/rationalType"},
            { "items": { "minimum": 1 } }
          ]
        }
      },
      "required": [ "count" ],
      "additionalProperties": true
    },

    "TLXmediaUnitRuntime": {
      "$id": "#TLXmediaUnitRuntime",
      "title": "TLXmediaUnitRuntime",
      "type": "object",
      "description": "The number of seconds for the media unit runtime.",
      "examples": [
        { "runtime": [ 1001, 30000 ] },
        { "runtime": [ 1, 50] },
        { "runtime": [ 110, 5000 ] },
        { "runtime": [ 1001, 30000 ], "extensible": null }
      ],
      "properties": {
        "runtime" : {
          "allOf": [
            { "$ref": "#/definitions/rationalType" },
            { "items": { "minimum": 1 } }
          ]
        }
      },
      "required": [ "runtime" ],
      "additionalProperties": true
    },

    "TLXuniqueSourceID": {
      "$id": "#TLXuniqueSourceID",
      "title": "TLXuniqueSourceID",
      "type": "object",
      "description": "The sourceID for the media unit.",
      "examples": [
        { "sourceID": "181c9ce2-e821-11eb-beb2-0242ac130002" },
        { "sourceID": "3b0b483d-834d-412a-ad40-ff62eff6948e" },
        { "sourceID": "335545ae-e821-11eb-beb2-0242ac130002", "extensible": null }
      ],
      "properties": {
        "sourceID" : {
          "type": "string",
          "pattern": "^[0-9a-f]{8}(-[0-9a-f]{4}){3}-[0-9a-f]{12}$",
          "not": { "enum": [ "00000000-0000-0000-0000-000000000000" ] }
        }
      },
      "required": [ "sourceID" ],
      "additionalProperties": true
    },

    "TLXsourceName": {
      "$id": "#TLXsourceName",
      "title": "TLXsourceName",
      "type": "object",
      "description": "The informal name of a source or sequence for the media unit.",
      "examples": [
        { "name": "tape 001" },
        { "name": "stage 07, camera 02" },
        { "name": "SN/1234567-03 rev 02" },
        { "name": "123456789012345678901234567890123456" },
        { "name": "a13b2693-0137-4680-9dc6-33d7bd7cc2b7" },
        { "name": "scene 25, take 2, camera 1" },
        { "name": "tape 001", "extensible": null }
      ],
      "properties": {
        "name": { "type": "string", "minLength": 1, "maxLength": 40}
      },
      "required": [ "name" ],
      "additionalProperties": true
    },

    "TLXst12": {
      "$id": "#TLXst12",
      "title": "TLXst12",
      "type": "object",
      "description": "SMPTE ST 12 timecode for the media unit.",
      "examples": [
        { "timeAddress": [ 1, 0, 9, 23 ]
        },
        { "timeAddress": [ 1, 0, 9, 24 ],
          "modulus": "25",
          "binaryGroups": "a7059414", "bgFlags": "4"
        },
        { "timeAddress": [ 1, 0, 9, 29 ], "fieldMark": false,
          "dropFrame": true, "modulus": "30",
          "binaryGroups": "47210719", "bgFlags": "6",
          "DBB1": "01", "DBB2": "00"
        },
        { "timeAddress": [ 23, 59, 59, 29 ], "fieldMark": true,
          "dropFrame": true, "modulus": "30",
          "binaryGroups": "47210722", "bgFlags": "6",
          "DBB1": "02", "DBB2": "00"
        }
      ],
      "properties": {
        "timeAddress": {
          "type": "array",
          "description": "[ hours, minutes, seconds, frames ]",
          "items": [
            { "type": "integer", "minimum": 0, "exclusiveMaximum": 24 },
            { "type": "integer", "minimum": 0, "exclusiveMaximum": 60 },
            { "type": "integer", "minimum": 0, "exclusiveMaximum": 60 },
            { "type": "integer", "minimum": 0, "exclusiveMaximum": 30 }
          ],
          "minItems": 4,
          "maxItems": 4
        },
        "dropFrame": {
          "type": "boolean",
          "default": false
        },
        "binaryGroups": {
          "allOf": [
            { "$ref": "#/definitions/hexstringType" },
            { "minLength": 8, "maxLength": 8 }
          ],
          "default": "00000000"
        },
        "bgFlags": {
          "description": "hexadecimal value for four bits: [ 0, BGF2, BGF1, BGF0 ]",
          "allOf": [
            { "$ref": "#/definitions/hexstringType" },
            { "pattern": "^[0-7]$" }
          ],
          "default": "0"
        },
        "colorFrame": {
          "type": "boolean",
          "default": false
        },
        "fieldMark": {
          "type": "boolean"
        },
        "subFrame": {
          "allOf": [
            { "$ref": "#/definitions/hexstringType" },
            { "pattern": "^[0-1][0-9a-f]$"  }
          ],
          "description": "hexadecimal value for five bits: [ 0, 0, 0, sub-frame_5, sub-frame_4, sub-frame_3, sub-frame_2, sub-frame_1 ]"
        },
        "modulus": {
          "description":  "A count for when the frames field rolls over.",
          "type": "string" ,
          "enum": [ "24", "25", "30", "48", "50", "60",
            "72", "96", "100", "120 (24x5)", "120 (30x4)" ]
        },
        "DBB1" : {
          "allOf": [
            { "$ref": "#/definitions/hexstringType" },
            { "minLength": 2 , "maxLength": 2 }
          ]
        },
        "DBB2" : {
          "allOf": [
            { "$ref": "#/definitions/hexstringType" },
            { "minLength": 2 , "maxLength": 2 }
          ]
        }
      },
      "required": [ "timeAddress" ],
      "additionalProperties": true
    }
  },

  "anyOf": [
    { "required": [ "TLXptpTimestamp" ] },
    { "required": [ "TLXmediaCount" ] },
    { "required": [ "TLXuniqueSourceID" ] },
    { "required": [ "TLXst12" ] },
    { "required": [ "TLXsourceName" ] },
    { "required": [ "TLXmediaUnitRuntime" ] }
  ],

  "definitions": {

    "integerType": {
      "type": "integer",
      "minimum": -9007199254740991,
      "maximum": 9007199254740991
    },

    "rationalType": {
      "type": "array",
      "items": [
        { "$comment": "numerator",
          "$ref": "#/definitions/integerType"},
        { "$comment": "demominator",
          "allOf": [
            {"$ref": "#/definitions/integerType"},
            { "not": { "enum": [ 0 ] } }
          ]
        }
      ],
      "minItems": 2,
      "additionalItems": false
    },

    "hexstringType": {
      "$comment": "lowercase only, minimum length 1",
      "type": "string",
      "pattern": "^[0-9a-f]+$"
    }
  }
}
